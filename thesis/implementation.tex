\chapter{Implementation} \label{Implementation}

\todo*{15-20\%; details on the implementation; for someone who wants to continue the work}

While the algorithms and protocols described in chapters \ref{Background} and \ref{Design} are language-independent, it is sensible to use C for the development, since it is widely supported on most \glspl{OS} including embedded \glspl{OS}. In this chapter the development environment and tools are introduced in \ref{Development Tools}, followed by descriptions of the implemented modules in \ref{Module Structure}. Important structures like the messages passed between nodes or the database entries are also described in \ref{Module Structure}. For the encryption of the messages the open-source library WolfCrypt is embedded (see \ref{Cryptography Module}).
In \fullref{Interfacing the Library} the implementation tasks required for the usage of this library in a C project (in a Linux environment) as well as in an Android project are demonstrated.

	\section{Development Tools}	\label{Development Tools}
	
	\todo*{use doxygen for documentation}

	\todo*{mention: development tools?}

	\section{Module Structure} \label{Module Structure}
	
	The framework follows a modular code design: functions are separated into modules based on affiliation.

	\todo*{UML class diagram}
	
	\todo*{modular programming: separating interface from implementation}
	
	\todo*{describe components ~documentation style}
	
	\subsection{Node Module} \label{Node Module}

	\todo*{describe the node-states: state machine in combination with state struct}
	
	\subsubsection{Message Protocol} \label{Message Protocol}

	\todo*{describe the message protocol detailed/bit level}
	
	\todo*{describe how the library encrypts the messages; flag for message to signal encryption (first Byte of payload 0/1)}
	
	\subsubsection{Database Entry} \label{Database Entry}

	\todo*{describe the database entry struct}
	
	Hashing with wolfCrypt: Embedded Crypto Engine
	
	\subsection{Non-Termination Detection Module} \label{Non-Termination Detection Module}
	
	\todo*{change label in component diagram}
	
	\subsection{Cryptography Module: WolfCrypt} \label{Cryptography Module}
	
	\gls{RSA}/\gls{AES} with wolfCrypt: Embedded Crypto Engine \textcite{Online:WolfCrypt}
	
	\todo*{describe how external system can provide better seeds for the public key system}
	
	
	\subsection{\gls{API} Module} \label{API Module}
	
	\todo*{change label in component diagram}
	
	\subsection{Configuration Module} \label{Configuration Module}
	
	\subsection{\gls{SMPC} Module} \label{SMPC Module}
	
	\todo*{describe the module for creating shares; describe generation of communication partner matrix; describe secure addition module; describe secure maximum module; describe secure minimum module}
	
	\section{Interfacing the Library} \label{Interfacing the Library}
	
		\todo*{external system: extend on \gls{RFCOMM}; widespread}
	
		\subsection{Configuration} \label{Configuration}
		
		\todo*{describe configuration.h: what can be configured, override of illegal configurations/sanity checks}
		
		\subsection{Usage in C}	\label{Usage in C}
		
		\todo*{describe usage of framework in a C environment with example for Linux with BlueZ stack-RFCOMM}
		\todo*{describe library is used in raspberry and in xadow}
		
		\subsection{Usage in Android} \label{Usage in Android}
		
		\todo*{describe how library is used with android \gls{NDK}; describe Java wrapper}
		
		\todo*{describe usage of framework in a Java environment with example for Android with Android Bluetooth API (Bluedroid stack)}
		
		\todo*{https://developer.android.com/reference/java/security/SecureRandom.html}
			
\FloatBarrier